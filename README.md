Всем привет!

Этим постом я с вами поделюсь тем, как именно я нарезал и собирал вместе
музыкальные отрывки из аниме сериала Nodame Cantabile.

Из всех серий всех трех сезонов аниме были выбраны эпизоды где исполняется та
или иная музыка (за считанными исключениями с фан сервисом ^_^). Между отрезками
вставлены коротенькие заставки. Нарезки из одной серии предваряются
соответствующим коротким кадром с названием (номером) эпизода. Все в итоге было
объединено в большие цельные фильмы на каждый из сезон в отдельности.

Результат воспроизводим и каждый, достаточно упо^упёртый, может его повторить.
Или, изменить тайминги и собрать своё видео. Исходники тут:
https://github.com/zOrg1331/nodame.git

Сами видео выложены сейчас в общую папку Яндекс.Диска:
https://yadi.sk/d/lsZr_11r26SDAw

На текущий момент я не закончил даже второй сезон. Поэтому файлы будут
добавляться постепенно.

# Зачем?

Nodame Cantabile -- это аниме сериал, состоящий из трёх сезонов, выходивших
начиная с 2006-го года. Это одно из немногих аниме, посвященных музыке. Более
того, классической музыке. Главные герои -- учащиеся японской консерватории,
почти "обыкновенные японские школьники". В отличии от других музыкальных
сериалов, на отношения между персонажами акцент большой не делается, но где тема
отношений возникает, она показана одновременно строго и довольно мило. Есть даже
серии чуть ли не целиком состоящие из исполнения тех или иных композиций.
Приятная рисовка, захватывающий, но не напрягающий сюжет и отличный юмор были по
достоинству оценены публикой и в рейтинге world-art.ru Nodame на первых местах
уже много лет.

Я этот сериал смотрел не единожды и каждый раз при просмотре возникает желание
закачать в плеер классической музыки. :) При этом лично я к классической музыке
имею мало отношения, только как эпизодический слушатель и посетитель концертов.
Те, кто учатся в консерватории или музыкальной школе могут найти что-то общее с
обучением, показанном в сериале (со скидкой, что дело происходит в Японии).

По умолчанию мы привыкли, что классическая музыка, концерты, это что-то для
элиты. Что-то сложное, скучное и малопонятное. Да, множество произведений вряд
ли интересны вне академической среды. Но даже те, кто постоянно классику не
слушает, наверняка знает (и готов послушать) отрывки из "Времен года", "Полёта
шмеля", "Щелкунчика" и многих других.

В Nodame Cantabile меня зацепила особенность подачи отрывков классической
музыки: новое произведение часто сопровождается комментарием героя с рассказом о
композиторе и что он этим произведением хотел сказать. Так мы немного больше
узнаем о том что слышим. Но это же аниме, значит зрительная составляющая важна.
И тут художники не только достойно изображают сам процесс игры на музыкальных
инструментах, но и показывают настроение героев. Это заметно усиливает эффект от
произведения и действительно вдохновляет.

Возможно, тронет это не каждого, но рекомендую хотя бы попробовать посмотреть,
если вы ещё этого не делали. Если же вас точно так же вдохновит, то этот
материал может оказаться полезным. Но если и не вдохновит, то у вас будет откуда
скопипастить код нарезки видео файлов. :)

# Как?

Я, внезапно, линуксоид, поэтому предпочитаю взаимодействовать с компьютерной
техникой посредством выдачи ей конкртеных команд, то есть, предпочитаю работу в
терминале. Это позволяет автоматизировать множество действий, хранить их
историю и воспроизводить в будущем. Так сказать постоянное программирование.

Вот и сейчас, если описать то, что я хотел сделать человеческим языком, то
получится примерно следующее:

- смотрим очередную серию очередного сезона;
- замечаем начало интересующего нас отрывка, отмечаем время;
- определяем момент, когда отрывок закончился, отмечаем время;
- копируем выбранные отрывки из просмотренного эпизода.

Как прошлись по каждому эпизоду -- объединяем их. Но, чтобы это всё не слилось в
малосмотрибельную кашу, добавляем короткие вставочки с более менее статичной
картинкой.

Описание выше вполне себе алгоритм. Действительно, просмотр серии процедура
ручная. Но копирование выбранных отрезков повторяется для каждого эпизода,
отличается только время. Обратная склейка тоже всегда будет одинакова. Этот
словесный легко (ну или по крайней мере так представляется) можно реализовать в
виде сценария.

У меня получилось несколько скриптов.

- `copy_pause.sh` -- скопировать отрезок, который будет потом вставляться между
  выбранными кусочками
- `copy_title.sh` -- скопировать отрезок с названием эпизода
- `copy.sh` -- скопировать из эпизода указанный фрагмент.

Эти три отличаются только настройками именно кодирования видео/звука, хотя по
сути делают похожие вещи.

- `merge.sh` -- склеивает нарезанные кусочки

- `copy_episode.sh` -- объединяет скрипты выше и выполняет всю работу по
  копированию и склеиванию отрезков из эпизода

- `merge_overall.sh` -- склеивает все получившиеся коротенькие эпизоды в один
  фильм

Чтобы настроить эти скрипты на конкретный релиз аниме, используются файлы

- `config_sX.sh` -- где X -- цифра, соответствующая номеру сезона.

Как эти скрипты вызываются можно посмотреть в `notes.org` файле. На самом деле
вызываются там только `copy_pause.sh`, `copy_episode.sh` и `merge_overall.sh`.
Мне, кажется, удалось минимизировать действия пользователя.

Для копирования видео в скриптах используется `ffmpeg`. Видео перекодируется,
это необходимо для встраивания субтитров. Последнее мне показалось просто более
удобным для раздачи результата другим. При копировании паузы или заголовка, звук
заглушается.

Для склеивания отрезков используется `mkvmerge` утилитка. Она вызывается из
скриптов и поэтому можно добавить автоматически разделение по главам. Это удобно
потом при просмотре.
